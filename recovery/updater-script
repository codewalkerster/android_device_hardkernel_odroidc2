#assert(getprop("ro.build.product" == "odroidc2"));

show_progress(1.0000, 0);

ui_print("\n\nHardkernel's ODROID-C2 Android Update is started...");
set_progress(0.1000);

ui_print("   'system' partition is flashing...");
write_sparse_image("rootsystem.img", "system", "/dev/block/mmcblk0p3");

set_progress(0.4000);

ui_print("   'userdata' partition is flashing...");
write_sparse_image("userdata.img", "userdata", "/dev/block/mmcblk0p4");

set_progress(0.5000);

ui_print("   FAT partition is now formatting...");
format("vfat", "EMMC", "/dev/block/mmcblk0p1", 0, "/sdcard");

set_progress(0.7000);

ui_print("   boot.ini.template is copying to /system/etc/");
mount("ext4", "EMMC", "/dev/block/mmcblk0p3", "/system");
package_extract_file("system/etc/boot.ini.template", "/system/etc/boot.ini.template");
unmount("/system");

set_progress(0.8000);

ui_print("   boot.ini is copying to FAT partition");
mount("vfat", "EMMC", "/dev/block/mmcblk0p1", "/sdcard");
package_extract_file("system/etc/boot.ini.template", "/sdcard/boot.ini");
unmount("/sdcard");

set_progress(0.9000);

ui_print("   formatting /dev/block/mmcblk0p1 for VFAT partition");
run_program("/bin/mkfs.vfat", "-n", "VFAT", "/dev/block/mmcblk0p1");

ui_print("Self installation is completed.\nHave fun with ODROID-C!\n\n");
set_progress(1.0000);
